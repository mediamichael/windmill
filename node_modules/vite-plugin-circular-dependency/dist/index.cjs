"use strict";var e=require("chalk"),o=require("node:fs"),t=require("@rollup/pluginutils"),n=require("node:path");class r{moduleId;importerModuleIds;children=null;constructor(e,o){this.moduleId=e,this.importerModuleIds=o}}function u(e,o){const t=new Set;!function e(n){t.add(n.moduleId);(function(e){const{importerModuleIds:t}=e;return t.filter((e=>o.get(e))).map((e=>o.get(e)))})(n).forEach((o=>{t.has(o.moduleId)||e(o),n.children||(n.children=new Set),n.children.add(o)}))}(e)}function d(e){const o=new Map,t=new Set;return function e(n,r){const{moduleId:u,children:d}=n;t.has(u)||(r.add(u),d?.forEach((t=>{const{moduleId:n}=t;r.has(n)?function(e,o){const t=e.sort(((e,o)=>e.moduleId<o.moduleId?-1:1)),n=t.map((e=>e.moduleId)).join("-");o.set(n,t)}(function(e,o){const t=[];let n=e;do{if(t.push(n),!n.children)break;n=Array.from(n.children).find((e=>o.has(e.moduleId)))}while(n&&n!==e);return t}(t,r),o):e(t,r)})),t.add(u),r.delete(u))}(e,new Set),o}function l(t,n){const r=function(e,o){return e.formatOut(function(e){return e.reduce(((e,o)=>{const t=o[0];return e[t]||(e[t]=[]),e[t].push(o),e}),{})}(function(e,o){return o.map((o=>o.map((o=>e.formatOutModulePath(o.moduleId)))))}(e,function(e){return Array.from(e.values()).filter((e=>e.length))}(o))))}(t,n);!function(t,n){t.outputFilePath?function(e,t){o.writeFileSync(e.outputFilePath,JSON.stringify(t,null,"\t"))}(t,n):function(o,t){Object.entries(t).forEach((t=>{const[n,r]=t;console.group(),console.log("\n\n"+e.yellow(o.formatOutModulePath(n))),r.forEach((o=>{console.log("\t"+o.map((o=>e.red(o))).join(e.blue(" -> ")))})),console.groupEnd()}))}(t,n)}(t,r),function(e,o){if(e.circleImportThrowErr&&o.length)throw new Error("has circular dependencies in this project")}(t,r)}function c(e){const o=function(e){let{include:o=[/\.[jt]sx?$/,/\.vue$/,/\.vue\?vue/,/\.svelte$/],exclude:t=[/[\\/]node_modules[\\/]/,/[\\/]\.git[\\/]/],outputFilePath:r="",circleImportThrowErr:u=!0,formatOutModulePath:d,formatOut:l}=e;r&&(r=n.join(process.cwd(),r));return{include:o,exclude:t,outputFilePath:r,circleImportThrowErr:u,formatOutModulePath:d??i,formatOut:l??s}}(e),{include:r,exclude:u}=o,d=t.createFilter(r,u),{getRootModuleNode:l,setRootModuleNode:c,moduleIdNodeMap:a}=function(){const{getRootModuleNode:e,setRootModuleNode:o}=function(){let e;return{getRootModuleNode:()=>e,setRootModuleNode(o){e||(e=o)}}}(),t=new Map;return{getRootModuleNode:e,setRootModuleNode:o,moduleIdNodeMap:t}}();return{...o,filter:d,getRootModuleNode:l,setRootModuleNode:c,moduleIdNodeMap:a}}function i(e){return n.relative(process.cwd(),e)}function s(e){return e}module.exports=e=>{const o=c(e),{filter:t,getRootModuleNode:n,setRootModuleNode:i,moduleIdNodeMap:s}=o;return{name:"vite-plugin-circular-dependency",moduleParsed:e=>{const{id:o}=e;if(!t(o))return;const n=function(e){const o=function(e){const{importedIds:o,dynamicallyImportedIds:t}=e;return[...o,...t]}(e),{id:t}=e;return new r(t,o)}(e);i(n),s.set(e.id,n)},generateBundle(){const e=n();if(!e)return void console.error("Failed to generate entry module");u(e,s);const t=d(e);l(o,t)}}};
