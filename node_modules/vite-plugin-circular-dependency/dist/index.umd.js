!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o(require("chalk"),require("node:fs"),require("@rollup/pluginutils"),require("node:path")):"function"==typeof define&&define.amd?define(["chalk","node:fs","@rollup/pluginutils","node:path"],o):(e="undefined"!=typeof globalThis?globalThis:e||self).CircularDependency=o(e.chalk,e.node_fs,e.pluginutils,e.node_path)}(this,(function(e,o,t,n){"use strict";class u{moduleId;importerModuleIds;children=null;constructor(e,o){this.moduleId=e,this.importerModuleIds=o}}function r(e,o){const t=new Set;!function e(n){t.add(n.moduleId);(function(e){const{importerModuleIds:t}=e;return t.filter((e=>o.get(e))).map((e=>o.get(e)))})(n).forEach((o=>{t.has(o.moduleId)||e(o),n.children||(n.children=new Set),n.children.add(o)}))}(e)}function d(e){const o=new Map,t=new Set;return function e(n,u){const{moduleId:r,children:d}=n;t.has(r)||(u.add(r),d?.forEach((t=>{const{moduleId:n}=t;u.has(n)?function(e,o){const t=e.sort(((e,o)=>e.moduleId<o.moduleId?-1:1)),n=t.map((e=>e.moduleId)).join("-");o.set(n,t)}(function(e,o){const t=[];let n=e;do{if(t.push(n),!n.children)break;n=Array.from(n.children).find((e=>o.has(e.moduleId)))}while(n&&n!==e);return t}(t,u),o):e(t,u)})),t.add(r),u.delete(r))}(e,new Set),o}function l(t,n){const u=function(e,o){return e.formatOut(function(e){return e.reduce(((e,o)=>{const t=o[0];return e[t]||(e[t]=[]),e[t].push(o),e}),{})}(function(e,o){return o.map((o=>o.map((o=>e.formatOutModulePath(o.moduleId)))))}(e,function(e){return Array.from(e.values()).filter((e=>e.length))}(o))))}(t,n);!function(t,n){t.outputFilePath?function(e,t){o.writeFileSync(e.outputFilePath,JSON.stringify(t,null,"\t"))}(t,n):function(o,t){Object.entries(t).forEach((t=>{const[n,u]=t;console.group(),console.log("\n\n"+e.yellow(o.formatOutModulePath(n))),u.forEach((o=>{console.log("\t"+o.map((o=>e.red(o))).join(e.blue(" -> ")))})),console.groupEnd()}))}(t,n)}(t,u),function(e,o){if(e.circleImportThrowErr&&o.length)throw new Error("has circular dependencies in this project")}(t,u)}function i(e){const o=function(e){let{include:o=[/\.[jt]sx?$/,/\.vue$/,/\.vue\?vue/,/\.svelte$/],exclude:t=[/[\\/]node_modules[\\/]/,/[\\/]\.git[\\/]/],outputFilePath:u="",circleImportThrowErr:r=!0,formatOutModulePath:d,formatOut:l}=e;u&&(u=n.join(process.cwd(),u));return{include:o,exclude:t,outputFilePath:u,circleImportThrowErr:r,formatOutModulePath:d??c,formatOut:l??s}}(e),{include:u,exclude:r}=o,d=t.createFilter(u,r),{getRootModuleNode:l,setRootModuleNode:i,moduleIdNodeMap:a}=function(){const{getRootModuleNode:e,setRootModuleNode:o}=function(){let e;return{getRootModuleNode:()=>e,setRootModuleNode(o){e||(e=o)}}}(),t=new Map;return{getRootModuleNode:e,setRootModuleNode:o,moduleIdNodeMap:t}}();return{...o,filter:d,getRootModuleNode:l,setRootModuleNode:i,moduleIdNodeMap:a}}function c(e){return n.relative(process.cwd(),e)}function s(e){return e}return e=>{const o=i(e),{filter:t,getRootModuleNode:n,setRootModuleNode:c,moduleIdNodeMap:s}=o;return{name:"vite-plugin-circular-dependency",moduleParsed:e=>{const{id:o}=e;if(!t(o))return;const n=function(e){const o=function(e){const{importedIds:o,dynamicallyImportedIds:t}=e;return[...o,...t]}(e),{id:t}=e;return new u(t,o)}(e);c(n),s.set(e.id,n)},generateBundle(){const e=n();if(!e)return void console.error("Failed to generate entry module");r(e,s);const t=d(e);l(o,t)}}}}));
